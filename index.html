<meta charset="UTF-8">
<div id= "text">Welcome, the password to stage 1 is "password123"</div>
<br>
stage number:<br>
<input id="lvl_nr"></input><br>
stage password:<br>
<input id="pass"></input>
<button onclick="next_stage();">goto stage</button>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="crypt_util.js"></script>
<script>
  function next_stage() {
    var lvl_nr = parseInt($("#lvl_nr").val(), 10);
    var pass = $("#pass").val();
    sha256(pass).then(function (pass_hash) {
      if (isNaN(lvl_nr)) {
        console.log("no number");
        return 0;
      }
      $.get('/stages/'+lvl_nr.toString()+'.html', function (stage, status, xhr) {
        if (status=="error") {
          //TODO: throw visible error: (wrong stage number)
          console.log(xhr.status + ' ' + xhr.statusText);
          return 0;
        }
        var arr = stage.split('\n\n');
        if ( pass_hash != arr[0] ) {
          //TODO: throw visible error: (wrong password)
          console.log("wrong pass");
          return 0;
        }
        aesGcmDecrypt(arr[1], pass).then(function (decr) {
          $("#text").html(decr);
          $(":input").val("");
        });
      });
    });
  }
</script>
